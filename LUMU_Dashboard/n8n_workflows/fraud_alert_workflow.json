{
  "name": "LUMU Fraud Detection Alert",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "lumu-fraud-alert",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Fraud Alert Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [220, 300],
      "webhookId": "lumu-fraud-alert"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 4
            }
          ]
        }
      },
      "id": "schedule-check",
      "name": "Check Every 4 Hours",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [220, 500]
    },
    {
      "parameters": {
        "url": "http://localhost:5000/api/fraud/overview",
        "options": {}
      },
      "id": "fetch-overview",
      "name": "Fetch Fraud Overview",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [480, 400]
    },
    {
      "parameters": {
        "url": "http://localhost:5000/api/fraud/invalid-clicks",
        "options": {}
      },
      "id": "fetch-invalid",
      "name": "Fetch Invalid Clicks",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [480, 560]
    },
    {
      "parameters": {
        "url": "http://localhost:5000/api/fraud/detailed-report",
        "options": {}
      },
      "id": "fetch-details",
      "name": "Fetch Detailed Report",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [480, 720]
    },
    {
      "parameters": {
        "jsCode": "const overview = $('Fetch Fraud Overview').first().json;\nconst invalidClicks = $('Fetch Invalid Clicks').first().json;\nconst details = $('Fetch Detailed Report').first().json;\n\n// Check for high fraud activity\nconst fraudPercentage = overview.invalidPercentage || 0;\nconst moneySaved = overview.moneySaved || 0;\nconst blockedIPs = overview.blockedIPs || 0;\n\nlet alertLevel = 'LOW';\nlet alertEmoji = 'ğŸŸ¢';\n\nif (fraudPercentage >= 15) {\n  alertLevel = 'CRITICAL';\n  alertEmoji = 'ğŸ”´';\n} else if (fraudPercentage >= 10) {\n  alertLevel = 'HIGH';\n  alertEmoji = 'ğŸŸ ';\n} else if (fraudPercentage >= 5) {\n  alertLevel = 'MEDIUM';\n  alertEmoji = 'ğŸŸ¡';\n}\n\n// Get top fraud types\nconst fraudTypes = details.fraudTypes || [];\nconst topFraudTypes = fraudTypes\n  .slice(0, 3)\n  .map(f => `â€¢ ${f.type}: ${f.count} clicks (${f.percentage}%)`)\n  .join('\\n');\n\n// Get recent blocks\nconst recentBlocks = (invalidClicks.data || [])\n  .slice(0, 5)\n  .map(b => `â€¢ ${b.ip} - ${b.reason} (${b.clicks} clicks)`)\n  .join('\\n');\n\n// Get recommendations\nconst recommendations = (details.recommendations || [])\n  .map(r => `ğŸ’¡ ${r}`)\n  .join('\\n');\n\nreturn [{\n  json: {\n    alertLevel,\n    alertEmoji,\n    fraudPercentage: fraudPercentage.toFixed(1),\n    moneySaved: `PKR ${(moneySaved / 1000).toFixed(1)}K`,\n    blockedIPs,\n    totalInvalidClicks: overview.invalidClicks || 0,\n    fraudScore: overview.fraudScore || 'Unknown',\n    topFraudTypes,\n    recentBlocks,\n    recommendations,\n    timestamp: new Date().toISOString(),\n    shouldAlert: fraudPercentage >= 8 // Alert if fraud is 8% or higher\n  }\n}];"
      },
      "id": "analyze-fraud",
      "name": "Analyze Fraud Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [760, 500]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "should-alert",
              "leftValue": "={{ $json.shouldAlert }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "should-alert",
      "name": "Should Alert?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1000, 500]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "alert-message",
              "name": "alertMessage",
              "value": "={{ $json.alertEmoji }} LUMU FRAUD ALERT\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸš¨ Alert Level: {{ $json.alertLevel }}\nğŸ“Š Fraud Rate: {{ $json.fraudPercentage }}%\nğŸ’° Money Saved: {{ $json.moneySaved }}\nğŸš« Blocked IPs: {{ $json.blockedIPs }}\nâŒ Invalid Clicks: {{ $json.totalInvalidClicks }}\n\nğŸ“ˆ TOP FRAUD TYPES:\n{{ $json.topFraudTypes }}\n\nğŸ”’ RECENT BLOCKS:\n{{ $json.recentBlocks }}\n\nğŸ“‹ RECOMMENDATIONS:\n{{ $json.recommendations }}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâ° {{ $json.timestamp }}\nLUMU AI Dashboard - ClickCease Integration",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "format-alert",
      "name": "Format Alert Message",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [1240, 400]
    },
    {
      "parameters": {
        "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
        "text": "={{ $json.alertMessage }}",
        "additionalFields": {}
      },
      "id": "send-telegram",
      "name": "Send Telegram Alert",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1480, 300]
    },
    {
      "parameters": {
        "channel": "={{ $env.SLACK_FRAUD_CHANNEL || '#fraud-alerts' }}",
        "text": "={{ $json.alertMessage }}",
        "otherOptions": {}
      },
      "id": "send-slack",
      "name": "Send Slack Alert",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [1480, 500]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "={{ $env.FRAUD_SHEET_ID }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "Fraud Alerts",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {}
        },
        "options": {}
      },
      "id": "log-sheet",
      "name": "Log to Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1480, 700]
    },
    {
      "parameters": {},
      "id": "no-alert",
      "name": "Low Fraud - No Alert",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1240, 600]
    }
  ],
  "connections": {
    "Fraud Alert Webhook": {
      "main": [
        [
          {
            "node": "Fetch Fraud Overview",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Every 4 Hours": {
      "main": [
        [
          {
            "node": "Fetch Fraud Overview",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Fraud Overview": {
      "main": [
        [
          {
            "node": "Fetch Invalid Clicks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Invalid Clicks": {
      "main": [
        [
          {
            "node": "Fetch Detailed Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Detailed Report": {
      "main": [
        [
          {
            "node": "Analyze Fraud Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Fraud Data": {
      "main": [
        [
          {
            "node": "Should Alert?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Should Alert?": {
      "main": [
        [
          {
            "node": "Format Alert Message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Low Fraud - No Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Alert Message": {
      "main": [
        [
          {
            "node": "Send Telegram Alert",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send Slack Alert",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log to Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "LUMU",
      "createdAt": "2025-01-09T00:00:00.000Z",
      "updatedAt": "2025-01-09T00:00:00.000Z"
    },
    {
      "name": "Fraud",
      "createdAt": "2025-01-09T00:00:00.000Z",
      "updatedAt": "2025-01-09T00:00:00.000Z"
    },
    {
      "name": "Security",
      "createdAt": "2025-01-09T00:00:00.000Z",
      "updatedAt": "2025-01-09T00:00:00.000Z"
    }
  ],
  "triggerCount": 2,
  "updatedAt": "2025-01-09T00:00:00.000Z",
  "versionId": "1"
}
